<!DOCTYPE html>

<html>
  <head>
    <title>Fjongdenger</title>
    <style>
      body {
        background-color: powderblue;
        font-size: 20px;
      }
      th,
      td {
        border: 1px solid black;
      }
    </style>
  </head>
  <body>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Activity</th>
          <th>Attendance</th>
          <th>Majors looted</th>
          <th>Minors looted</th>
          <th>Last Major</th>
          <th>Last Minor</th>
          <th>Kills since last Major</th>
          <th>Kills since last Minor</th>
        </tr>
      </thead>
      <tbody id="users"></tbody>
    </table>

    <h1 style="color:blueviolet;">DKP Weights</h1>
    <pre id="dkp_weights" style="color:blueviolet; font-weight: bold;"></pre>

    <script type="text/javascript">
      let users = ["Lerion", "Twig", "Radji", "Wixo"];

      let fetchData = () => {
        fetch(
          "https://kbf0hkyvyg.execute-api.eu-central-1.amazonaws.com/dev/hgdata"
        )
          .then(response => response.json())
          .then(data => {
            users.forEach(user => {
              const id = Object.keys(data.users)
                .map(key => data.users[key])
                .find(_user => user === _user.name).id;
              const minor = data.dkp.minor.find(m => m.user_id == id);
              const major = data.dkp.major.find(m => m.user_id == id);

              const newRow = document.getElementById("users").insertRow();

              newRow.insertCell().appendChild(document.createTextNode(user));
              newRow
                .insertCell()
                .appendChild(document.createTextNode(major.activity));
              newRow
                .insertCell()
                .appendChild(document.createTextNode(major.attendance));
              newRow
                .insertCell()
                .appendChild(document.createTextNode(major.loot));
              newRow
                .insertCell()
                .appendChild(document.createTextNode(minor.loot));
              newRow
                .insertCell()
                .appendChild(
                  document.createTextNode(
                    new Date(major.last_loot).toDateString()
                  )
                );
              newRow
                .insertCell()
                .appendChild(
                  document.createTextNode(
                    new Date(minor.last_loot).toDateString()
                  )
                );
              newRow
                .insertCell()
                .appendChild(document.createTextNode(major.kills_since_loot));
              newRow
                .insertCell()
                .appendChild(document.createTextNode(minor.kills_since_loot));

              document.getElementById("dkp_weights").innerHTML = JSON.stringify(
                data.dkp_weights,
                undefined,
                2
              );
            });
          });
      };

      fetchData();
    </script>
  </body>
</html>
